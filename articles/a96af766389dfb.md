---
title: "onWheelãŒçµ‚ã‚ã£ãŸç›´å¾Œã®å‡¦ç†ã‚’æ›¸ãã¨ãã®Tips"
emoji: "ğŸ°"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["javascript", "react"]
published: true
---

## çµè«–

`onWheel`ãŒçµ‚äº†ã—ãŸç›´å¾Œã®å‡¦ç†ã‚’æ›¸ãã«ã¯`setTimeout`ã¨`clearTimeout`ã‚’ä½¿ãˆã°ã„ã„æ„Ÿã˜ã«å®Ÿè£…ã§ãã‚‹

ä¸‹è¨˜Gifã¯ã¡ã‚‡ã£ã¨ã‚ã‹ã‚Šã¥ã‚‰ã„ã‹ã‚‚ã—ã‚Œãªã„ãŒã€wheelã—ã¦ã„ã‚‹é–“ã¯deltaX(æ¨ªæ–¹å‘ã¸ã®ç§»å‹•ã—ãŸé‡)ã‚’consoleã«å‡ºåŠ›ã—ã¤ã¤ã€wheelãŒçµ‚ã‚ã£ãŸã‚‰`wheelãŒçµ‚äº†ã—ãŸã‚ˆ`ã‚’consoleã«å‡ºåŠ›ã—ã¦ã„ã‚‹

![onWheelãŒçµ‚ã‚ã£ãŸç›´å¾Œã«console.logã—ã¦ã‚‹gif](/images/on-wheel/on-wheel.gif)

## ã¯ã˜ã‚ã«

ã¨ã‚ã‚‹ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã¨åŒã˜ã‚ˆã†ãªæ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã‚¿ã‚¹ã‚¯ãŒã‚ã‚Šã€ãã®æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã«ã¯æ¨ªã«wheelã—ãŸå¾Œã«å‡¦ç†ã‚’å…¥ã‚Œã‚‹å¿…è¦ãŒã‚ã£ãŸãŒã€`WheelEvent`ã«ãã‚Œã‚‰ã—ã„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ãªãã€wheelãŒçµ‚äº†ã—ãŸå¾Œã«ã©ã®ã‚ˆã†ã«å‡¦ç†ã‚’å…¥ã‚Œã‚‹ã‹ã‚ã‹ã‚‰ãšè©°ã¾ã£ãŸã€‚
ã¨ã‚ã‚‹ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆä¸Šã§Chromeã®DevToolsã‚’é–‹ãã€ãƒ“ãƒ«ãƒ‰ã•ã‚ŒãŸå¾Œã®jsã¨ç¨ã‚ã£ã“ã—ã¦ã€wheelãŒçµ‚äº†ã—ãŸå¾Œã«ã©ã®ã‚ˆã†ã«å‡¦ç†ã‚’å…¥ã‚Œã¦ã‚‹ã‹ã‚’è§£èª­ã—ãŸã‚‰çµæ§‹å‚è€ƒã«ãªã£ãŸã®ã§ã¾ã¨ã‚ã‚‹ã“ã¨ã«ã—ãŸã€‚

## è¨˜äº‹ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ

- [wheelã‚¤ãƒ™ãƒ³ãƒˆ](https://developer.mozilla.org/ja/docs/Web/API/WheelEvent)ãŒçµ‚äº†ã—ãŸã¨ãã«ä½•ã‹å‡¦ç†ã‚’ã—ãŸã„äºº

## å®Ÿè£…ã—ãŸã‚³ãƒ¼ãƒ‰

:::details ã‚³ãƒ¼ãƒ‰å…¨å®¹
```tsx
import { useEffect, useState, WheelEvent } from 'react'

export const Test = (): JSX.Element => {
  const [wheelEndTimeout, setWheelEndTimeout] = useState<
    NodeJS.Timeout | undefined
  >(undefined)
  const [isWheel, setIsWheel] = useState(false)

  useEffect(() => {
    const clear = () => {
      if (wheelEndTimeout) {
        clearTimeout(wheelEndTimeout)
      }
    }
    return clear()
  }, [])

  const handleWheel = (e: WheelEvent<HTMLDivElement>) => {
    console.log(e.deltaX)

    setIsWheel(true)

    if (wheelEndTimeout) {
      clearTimeout(wheelEndTimeout)
      setWheelEndTimeout(undefined)
    }

    if (isWheel) {
      const wheelEndTimeoutId = setTimeout(() => {
        setIsWheel(false)
        console.log('wheelãŒçµ‚äº†ã—ãŸã‚ˆ')
        // NOTE: ã“ã“ã«wheelçµ‚äº†å¾Œã®å‡¦ç†ã‚’æ›¸ã
      }, 100)
      setWheelEndTimeout(wheelEndTimeoutId)
    }
  }

  return (
    <div
      className="flex items-center justify-center w-96 h-screen bg-primary"
      onWheel={handleWheel}
    >
      <p>ã“ã“ã‚’ãƒ›ã‚¤ãƒ¼ãƒ«ã—ã¦ã¿ã¦</p>
    </div>
  )
}
```
:::

## wheelã‚¤ãƒ™ãƒ³ãƒˆãŒçµ‚äº†ã—ãŸå¾Œã«ã©ã®ã‚ˆã†ã«å‡¦ç†ã‚’å…¥ã‚Œã‚‹ã‹

1. wheelä¸­ã‹ã©ã†ã‹ã‚’ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®stateã«ä¿æŒã™ã‚‹
2. wheelä¸­ã«setTimeoutãŒå‘¼ã³å‡ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯clearTimeoutã™ã‚‹
3. wheelä¸­ã®å ´åˆã¯100mså¾Œã«wheelä¸­ã‹ã©ã†ã‹ã®stateã‚’falseã«ã™ã‚‹setTimeoutã‚’å‘¼ã¶(setTimeoutã®ãªã‹ã«wheelçµ‚äº†å¾Œã®å‡¦ç†ã‚’ã‹ã)

ã–ã£ãã‚Šè¨€ã†ã¨setTimeoutã®ä¸­ã«wheelã‚¤ãƒ™ãƒ³ãƒˆçµ‚äº†æ™‚ã®å‡¦ç†ã‚’å®šç¾©ã—ã€wheelã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã•ã‚Œã‚‹ãŸã³ã«setTimeoutã®æ™‚é–“ã‚’100msç§’ä¼¸ã°ã—ã¦ã¾ã™

```tsx
const [wheelEndTimeout, setWheelEndTimeout] = useState<
    NodeJS.Timeout | undefined
  >(undefined) // setTimeoutã‚’è­˜åˆ¥ã™ã‚‹ãŸã‚ã®idã‚’ä¿æŒ
const [isWheel, setIsWheel] = useState(false) // wheelä¸­ã‹ã©ã†ã‹ã®çŠ¶æ…‹ã‚’ä¿æŒ

const handleWheel = (e: WheelEvent<HTMLDivElement>) => {
  console.log(e.deltaX)

  setIsWheel(true) // onWheelä¸­ã®ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹

  if (wheelEndTimeout) {
    clearTimeout(wheelEndTimeout)ã€€// ã™ã§ã«setTimeoutã§100mså¾Œã«onWheelçµ‚äº†ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ãŸã‚‰setTimeoutã‚’clearã™ã‚‹
    setWheelEndTimeout(undefined)
  }

  if (isWheel) {
    const wheelEndTimeoutId = setTimeout(() => {
      setIsWheel(false) // wheelä¸­ã§ã‚ã‚Œã°100mså¾Œã«wheelãŒçµ‚äº†ã™ã‚‹ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹
      console.log('wheelãŒçµ‚äº†ã—ãŸã‚ˆ')
      // NOTE: ã“ã“ã«wheelçµ‚äº†å¾Œã®å‡¦ç†ã‚’æ›¸ã

    }, 100)
    setWheelEndTimeout(wheelEndTimeoutId)
  }
}
```

å¿µã®ãŸã‚ã€ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆæ™‚ã«setTimeoutãŒç”Ÿãã¦ã„ãŸå ´åˆã¯clearã™ã‚‹ã‚ˆã†ã«useEffectã§å®šç¾©ã—ã¦ãŠã
```tsx
useEffect(() => {
  const clear = () => {
    if (wheelEndTimeout) {
      clearTimeout(wheelEndTimeout)
    }
  }
  return clear()
}, [])
```


## æ‰€æ„Ÿ

wheelã‚¤ãƒ™ãƒ³ãƒˆã‚„scrollã‚¤ãƒ™ãƒ³ãƒˆãªã©ã€ãã®ã¾ã¾ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ã¯çµ‚äº†ã—ãŸçŠ¶æ…‹ã‚’æŠŠæ¡ã™ã‚‹ã®ãŒé›£ã—ã„å ´åˆã«ã€setTimeoutã¨clearTimeoutã‚’é§†ä½¿ã—ã¦çµ‚äº†æ™‚ã®å‡¦ç†ã‚’æ›¸ãã®ã¯æ‰‹æ³•ã®ä¸€ã¤ã¨ã—ã¦è‰¯ã•ã’ãªæ°—ãŒã—ãŸ

