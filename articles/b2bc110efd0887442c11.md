---
title: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã§å®Œçµã™ã‚‹ESLintã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ«ãƒ¼ãƒ«ã‚’ä½œã‚ŠãŸã„"
emoji: "ğŸ–ï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["eslint"]
published: true
---

## ã¯ã˜ã‚ã«

ã‚ã‚‹æ—¥ã€ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§å®šç¾©ã—ãŸå„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä¾å­˜é–¢ä¿‚ãŒæ­£ã—ã„ã‹ã©ã†ã‹ã‚’ ESLint ãŒãƒã‚§ãƒƒã‚¯ã—ã¦ãã‚Œã‚‹ã¨æ¥½ã ã‚ˆã­ã¨ã„ã†è©±ãŒå‡ºãŸ(ä»Šã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯[ã“ã®ã‚ˆã†ãªæ§‹æˆ](https://zenn.dev/kichion/articles/fddf0eb35ffa2a)ã‚’å–ã‚Šå…¥ã‚Œã¦ãŠã‚Šã¾ã™)

ESLint ã«è¿½åŠ ã—ãŸã„ãƒ«ãƒ¼ãƒ«ã®è¦ä»¶ã‚’æ•´ç†ã—ã¦ã¿ã‚‹ã¨ã‚ã–ã‚ã– plugin ã¨ã—ã¦å…¬é–‹ã™ã‚‹ã»ã©æ±ç”¨çš„ãªã‚‚ã®ã§ã‚‚ãªã„ã¨æ€ã„ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã§å®Œçµã™ã‚‹ ESLint ã®ç‹¬è‡ªãƒ«ãƒ¼ãƒ«ã‚’ä½œã£ã¦ã¿ãŸã¨ã„ã†ãŠè©±

### ã‚´ãƒ¼ãƒ«

ä¸‹è¨˜ã«ç¤ºã™ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã§ä»¥ä¸‹ã®æ¡ä»¶ã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸã„

- `domains`é…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯`infrastructures`ã€`adapters`, `usecases`, `view-models`ã‚’ import ã—ãªã„
- `usecase`é…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯`infrastructures`ã€`adapters`ã‚’ import ã—ãªã„
- `view-models`é…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯`infrastructures`ã€`adapters`, `usecases`ã‚’ import ã—ãªã„

:::details ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

é–¢ä¿‚ã‚ã‚‹ã¨ã“ã‚ã ã‘

```
src/core
â”œâ”€â”€ adapters
â”œâ”€â”€ domains
â”œâ”€â”€ infrastructures
â”œâ”€â”€ usecases
â””â”€â”€ view-models
```

[å…¨ä½“è±¡](https://zenn.dev/kichion/articles/fddf0eb35ffa2a#%E5%AE%9F%E9%9A%9B%E3%81%AB%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B)

:::

## è¨˜äº‹ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ

- plugin ä½œã‚‹ã¾ã§ã§ã‚‚ãªã„ã‘ã©ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã« ESLint ã® rule ã‚’ç‹¬è‡ªã§ã¤ãã‚ŠãŸã„äºº
- ESLint ã§ã‚ªãƒ¬ã‚ªãƒ¬ãƒ«ãƒ¼ãƒ«ã‚’ä½œã‚Šä»–äººã®ã‚³ãƒ¼ãƒ‰ã‚’åˆ¶é™ã—ãŸã„äºº

## ç’°å¢ƒ

é–¢ä¿‚ã‚ã‚Šãã†ãªã®ã ã‘

```json:package.json
  "devDependencies": {
    "@typescript-eslint/experimental-utils": "4.21.0",
    "eslint": "7.23.0",
    "eslint-plugin-rulesdir": "0.2.0",
    "typescript": "4.2.3",
  },
```

## ã„ã–å®Ÿè£…

ä»Šå›ã¯ typescript ã§ãƒ«ãƒ¼ãƒ«ã‚’æ›¸ããŸã‹ã£ãŸã®ã§ä¸‹è¨˜ã®ã‚ˆã†ãªæµã‚Œã§é–‹ç™ºã‚’ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸ

1. typescript ã§ rule ã‚’å®šç¾©
2. ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«
3. ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚ŒãŸ js ã‚’ eslint ã® rule ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹

ã¾ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ§‹æˆã¯ä¸‹è¨˜ã®ã‚ˆã†ã«ã—ã¾ã—ãŸ
(`clean-arch`ã¨ã„ã†ç‹¬è‡ªãƒ«ãƒ¼ãƒ«ã‚’ä½œã‚‹å‰æ)

```
eslint-rules
â”œâ”€â”€ README.md
â”œâ”€â”€ dist
â”‚Â Â  â””â”€â”€ clean-arch.js
â”œâ”€â”€ docs
â”‚Â Â  â””â”€â”€ clean-arch.md
â”œâ”€â”€ rules
â”‚Â Â  â””â”€â”€ clean-arch.ts
â”œâ”€â”€ tests
â”‚Â Â  â””â”€â”€ clean-arch.test.ts
â””â”€â”€ tsconfig.json
```

ãã‚Œãã‚Œ

- `dist` ts ã§æ›¸ã„ãŸ rules ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«å¾Œã® js
- `docs` rule ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- `rules` rule ã®å®šç¾©å ´æ‰€
- `test` rule ã®ãƒ†ã‚¹ãƒˆ
- `tsconfig.json` ts ã§æ›¸ã‹ã‚ŒãŸ rule ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹è¨­å®šã‚’è¨˜è¼‰

:::details ã‚³ãƒ¼ãƒ‰å…¨ä½“

```typescript
import { TSESLint } from "@typescript-eslint/experimental-utils";

const cleanArch: TSESLint.RuleModule<"cleanArch", []> = {
  meta: {
    type: "suggestion",
    messages: {
      cleanArch: "{{ message }}",
    },
    schema: [],
  },
  create: (context) => {
    return {
      ImportDeclaration(node) {
        // HACK: ã‚ã‚“ã¾ã‚Šæ›¸ãæŒ¯ã‚Šã¯è¦‹ãªã„ã§ã‡ã‡

        // pathã«'src/core'ãŒå«ã¾ã‚Œã¦ã‚‹ã‹
        // pathä¾‹ /Users/yhada/dev/project-name/src/core/adapters/foo/index.ts
        const filePath = context.getFilename();
        const existCore = filePath.indexOf("src/core");
        if (existCore === -1) return;

        // pathã«'src'ãŒè¤‡æ•°ã‚ã‚‹ã‹
        const splitPaths = filePath.split("/");
        const matchSrcNames = splitPaths.filter((s) => s === "src");
        if (matchSrcNames.length !== 1) return;

        // 'src/core/{layerName}'ã¾ã§pathãŒã‚ã‚‹ã‹
        const srcIndex = splitPaths.indexOf("src");
        const layerIndex = srcIndex + 2;
        if (splitPaths.length < layerIndex - 1) return;

        // importæ–‡ã«coreãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹
        // importæ–‡ä¾‹ import { FooModel } from 'core/domains/models/foo'
        const importPath = node.source.value;
        if (typeof importPath !== "string") return;
        const existImportCorePath = importPath.indexOf("core");
        if (existImportCorePath === -1) return;

        // 'core/{layerName}/{resourceName}/{fileName}'ã¾ã§pathãŒã‚ã‚‹ã‹
        const splitImportPaths = importPath.split("/");
        if (splitImportPaths.length < 3) return;

        // è©²å½“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¨importã§å‘¼ã‚“ã§ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ã©ã®å±¤ã‹å–å¾—
        const layer = splitPaths[layerIndex];
        const importLayer = splitImportPaths[1];

        // HACK: é–¢æ•°åˆ†ã‘ã‚‹
        if (layer === "domains") {
          if (
            importLayer === "usecases" ||
            importLayer === "adapters" ||
            importLayer === "infrastructures" ||
            importLayer === "view-models"
          ) {
            context.report({
              node,
              messageId: "cleanArch",
              data: {
                message: `domainsã§ã¯${importLayer}ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ããªã„ã‚ˆ`,
              },
            });
          }
        }

        if (layer === "usecases") {
          if (importLayer === "adapters" || importLayer === "infrastructures") {
            context.report({
              node,
              messageId: "cleanArch",
              data: {
                message: `usecasesã§ã¯${importLayer}ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ããªã„ã‚ˆ`,
              },
            });
          }
        }

        if (layer === "view-models") {
          if (
            importLayer === "adapters" ||
            importLayer === "infrastructures" ||
            importLayer === "usecases"
          ) {
            context.report({
              node,
              messageId: "cleanArch",
              data: {
                message: `view-modelsã§ã¯domain modelã‹componentã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã—ã‹ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ããªã„ã‚ˆ`,
              },
            });
          }
        }
      },
    };
  },
};

module.exports = cleanArch;

// ãƒ†ã‚¹ãƒˆã®æ™‚ã« import ã—ãŸã„ã®ã§export defaultã—ã¦ã‚‹
export default cleanArch;
```

:::

### å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

eslint ã¨ typescript ã¯ã™ã§ã«é‹ç”¨ã•ã‚Œã¦ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãªã‚‰å…¥ã£ã¦ã‚‹ã¨ã—ã¦`@typescript-eslint/experimental-utils`ã‚’å…¥ã‚Œã‚‹ã“ã¨ã§ eslint ã® rule ã‚’ typescript ã§æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚Šã‚„ã™
[ã“ã®è¨˜äº‹](https://zenn.dev/kyoncy/articles/aa24cf54441215)ãŒå‚è€ƒã«ãªã‚Šã‚„ã—ãŸ

ã¾ãŸã€`eslint-plugin-rulesdir`ã‚’å…¥ã‚Œã‚‹ã“ã¨ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã§å®šç¾©ã—ãŸç‹¬è‡ªãƒ«ãƒ¼ãƒ«ã‚’ plugin ã¨ã—ã¦æ‰±ã†ã“ã¨ãŒã§ãã¾ã™ã€‚
(`eslint-plugin-rulesdir`ã«ã¤ã„ã¦ã¯è£œè¶³ã‚’å¾Œè¿°ã—ã¾ã™)

### ruleã‚’æ›¸ã

ruleã¯`@typescript-eslint/experimental-utils`ã®`TSESLint.RuleModule`ã®å‹ã‚’å……ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’`module.exports`ã™ã‚Œã°è‰¯ãã§ã™

`TSESLint.RuleModule`ã¯ meta ã¨ create äºŒã¤ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æŒã£ã¦ãŠã‚Šã€meta ã¯ãã®ã¾ã‚“ã¾ã§ä½œã‚‹ruleã®ãƒ¡ã‚¿æƒ…å ±ã‚’å®šç¾©ã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ã€create ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ eslint ã®ruleã‚’å®šç¾©ã—ã¾ã™

[ã©ã®ã‚ˆã†ãª meta ãŒã‚ã‚‹ã®ã‹ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¸ Let's Go!](https://eslint.org/docs/developer-guide/working-with-rules)

#### ã©ã®ã‚ˆã†ã«ã‚³ãƒ¼ãƒ‰ã‚’è§£æã™ã‚‹ã®ã‹çŸ¥ã‚ã†

ESLint ã¯æ›¸ã‹ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’ AST(æŠ½è±¡æ§‹æ–‡æœ¨)ã¨ã„ã†å½¢å¼ã§èªè­˜ã—ã¦ãã‚Œã¾ã™
AST?ï¾…ï¾†ï½¿ï¾šï½µï½²ï½¼ï½²ï¾‰??çŠ¶æ…‹ã«é™¥ã‚‹ã‚“ã§ã™ãŒå®‰å¿ƒã—ã¦ãã ã•ã„
ã“ã®ä¸–ã«ã¯ `AST Explorer` ãªã‚‹ã¨ã¦ã‚‚ä¾¿åˆ©ãªã‚‚ã®ãŒã‚ã‚Šã¾ã™
https://astexplorer.net/

![AST EXplorerã®ã‚¹ã‚¯ã‚·ãƒ§](https://storage.googleapis.com/zenn-user-upload/8mlcd0bop2e2t3u7q3kxb50g595l)
*AST EXplorer*

ä¸Šã®ã‚¹ã‚¯ã‚·ãƒ§ã‚’è¦‹ã¦ã‚‚ã‚‰ãˆã‚‹ã¨ã‚¤ãƒ¡ãƒ¼ã‚¸æ´ã‚ã‚‹ã¨æ€ã†ã‚“ã§ã™ãŒã€å·¦å´ã«ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã‚‹ã¨ AST ã¨ã—ã¦ã“ã‚“ãªãµã†ã«èªè­˜ã—ã¦ã‚‹ã‚ˆã£ã¦ã®ã‚’å³å´ã«è¡¨ç¤ºã—ã¦ãã‚Œã¾ã™

ä»Šå›ã¯ä½¿ã„ãŸã„ rule ã¯ import æ–‡ã® from ä»¥é™ã®éƒ¨åˆ†ãªã®ã§ã€ãã“ã‚’`AST Explorer`ã§é¸æŠã—ã¦ã¿ã‚‹ã¨`ImportDeclaration`ã®ä¸­ã«ã‚ã‚‹ source ã® value ãŒè©²å½“ã™ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™

![importæ–‡ã®fromä»¥é™ã®éƒ¨åˆ†](https://storage.googleapis.com/zenn-user-upload/hrdl6gc35xs96yololu4wdagua5u)
*importæ–‡ã®fromä»¥é™ã®éƒ¨åˆ†*

ã¾ãŸ import æ–‡ã® from ä»¥é™ã®éƒ¨åˆ†ä»¥å¤–ã« lint å¯¾è±¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚‚å–å¾—ã—ãŸã„ã®ã§ã™ãŒã€ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã¯`context.getFileName()`ã§å–å¾—ã§ãã¾ã™

rule ã«å¿…è¦ãªå€¤ã‚’å–å¾—ã™ã‚‹æ›¸ãæ–¹ã¯ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚Šã¾ã™

```typescript
create: (context) => {
  return {
    ImportDeclaration(node) {
      // importæ–‡ã®fromä»¥é™ã®éƒ¨åˆ†
      const fromValue = node.source.value;
      // lintå¯¾è±¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
      const filePath = context.getFilename();
    },
  };
};
```

ä¸Šè¨˜ã§å‡ºã¦ããŸ context ã‚„ nodeã€ImportDeclaration ãªã©ã¯`TSESLint`ã‹ã‚‰é¡ã£ã¦å‹ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã§ã©ã®ã‚ˆã†ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒã‚ã‚‹ã®ã‹ãªã©ã¯å‹å®šç¾©ã‚’è¦‹ã¦ã‚‚ã‚‰ãˆã‚Œã°ã‚¤ãƒ¡ãƒ¼ã‚¸ã¤ãã‹ã¨!(TypeScript ã‚µã‚¤ã‚³ã‚¦!!)

#### rule ã«é•åã—ã¦ã‚‹ã“ã¨ã‚’å®šç¾©ã—ã‚ˆã†

`context.report()`ã‚’ä½¿ã†ã“ã¨ã§å®šã‚ã‚‰ã‚ŒãŸ rule ã«é•åã—ã¦ã„ã‚‹ã“ã¨è¡¨ç¾ã§ãã¾ã™

report ãƒ¡ã‚½ãƒƒãƒ‰ã«æ¸¡ã™å¼•æ•°ã® `messageId` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯`TSESLint.RuleModule`ã®ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ã®å‹ã®ä¸€ã¤ç›®ã® stringã‚’æŒ‡ã—ã¦ã¦ã€`data` ã®ä¸­ã«å¯å¤‰ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å®šç¾©ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™

```typescript
meta: {
  type: 'suggestion',
  messages: {
    // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ§‹æ–‡ã¿ãŸã„ãªæ›¸ãæ–¹
    // context.reportã®dataã§å®šç¾©ã•ã‚ŒãŸãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ä½¿ãˆã‚‹
    cleanArch: '{{ message }}',
  },
  schema: [],
},
create: (context) => {
  return {
    ImportDeclaration(node) {
      if ('ruleãŒé•åã—ãŸå ´åˆã«trueã‚’è¿”ã™æ¡ä»¶å¼') {
        context.report({
          node,
          messageId: "cleanArch",
          data: {
            message: `ã“ã“ã«ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒæ›¸ã‘ã‚‹`,
          },
        });
      }
    },
  };
};
```

#### ts ã§æ›¸ã„ãŸ rule ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã‚ˆã†

:::details tsconfig.json ã‚’å®šç¾©ã—ã‚ˆã†

```json: eslint-rules/tsconfig.json
{
  "compilerOptions": {
    "target": "es2015",
    "module": "commonjs",
    "outDir": "./dist",
    "strict": true,
    "moduleResolution": "node",
    "esModuleInterop": true,
    "skipLibCheck": true
  },
  "include": ["./rules/*.ts"]
}

```

:::

package.json ã«ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰ã®è¿½åŠ 
` "build-eslint": " yarn tsc -p eslint-rules/tsconfig.json",`

#### rule ã®ãƒ†ã‚¹ãƒˆã‚’ã—ã‚ˆã†

è‡ªåˆ†ã§å®šç¾©ã—ãŸruleã®ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã¾ã™
[ã“ã“ã‚’å‚è€ƒã«ã—ã¾ã—ãŸ](https://zenn.dev/kyoncy/articles/aa24cf54441215#%E3%83%86%E3%82%B9%E3%83%88%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B)

`TSESLint.RuleTester`ã® run ãƒ¡ã‚½ãƒƒãƒ‰ã®ä¸­ã§ valid ã¨ invalid ã« code ã‚’æ¸¡ã™æ„Ÿã˜
context ã‹ã‚‰ä½¿ã£ãŸå€¤ã¯ã ã„ãŸã„ valid ã‚„ invalid ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã—ã¦å®šç¾©ã§ãã‚‹ã¯ãš(fileName ã®ã‚ˆã†ã«)
(valid ã‚„ invalid ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯å‹å®šç¾©ã•ã‚Œã¦ã‚‹ã®ã§æ°—ã«ãªã‚‹å ´åˆã¯å‹å®šç¾©ã‚’ã¿ã¦ã¿ã‚„ã—ã‚‡ã†)

```typescript
import { TSESLint } from '@typescript-eslint/experimental-utils'
import cleanArch from "../rules/clean-arch";

const tester = new TSESLint.RuleTester({
  parser: require.resolve("espree"),
  parserOptions: {
    ecmaVersion: 2020,
    sourceType: "module",
    ecmaFeatures: {
      jsx: true,
    },
  },
});

describe("clean-arch rule test", () => {
  tester.run(`clean-arch`, cleanArch, {
    //
    valid: [
      {
        filename: "src/core/usecases/foo.ts",
        code: `import { FooModel } from 'core/domains/models/foo'`,
      },
    ],
    invalid: [
      {
        filename: "src/core/domains/foo.ts",
        code: `import { FooImpl } from 'core/adapters/foo'`,
        errors: [{ messageId: "cleanArch" }],
      },
    ],
  });
});
```

#### ç‹¬è‡ªã§ä½œã£ãŸ rule ã‚’è¨­å®šã—ã‚ˆã†

`.eslintrc.js`ã«ç‹¬è‡ªã§ä½œã£ãŸ rule ã‚’è¿½åŠ ã™ã‚‹

```js:.eslintrc.js
const rulesDirPlugin = require('eslint-plugin-rulesdir')
rulesDirPlugin.RULES_DIR = 'eslint-rules/dist'

// é–¢ä¿‚ã‚ã‚‹ã¨ã“ã‚ã®ã¿
module.exports = {
  plugins: [
    'rulesdir',
  ],
  rules: {
    'rulesdir/clean-arch': 'error',
  },
}
```

ä½œæˆã—ãŸ rule ã‚’ build ã—ãŸå¾Œã« vscode ã®æ‹¡å¼µãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ãªã„å ´åˆ reload ã™ã‚Œã°é©å¿œã•ã‚Œã‚‹ã¯ãš

![ç‹¬è‡ªãƒ«ãƒ¼ãƒ«ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¨ã“ã‚](https://storage.googleapis.com/zenn-user-upload/f8dsj99h1yt0igu3z7nip62ykg5i)
*ç‹¬è‡ªãƒ«ãƒ¼ãƒ«ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¨ã“ã‚*

## è£œè¶³ 1. eslint-plugin-rulesdir ã«ã¤ã„ã¦

[lint å®Ÿè¡Œæ™‚ã«--rulesdir ã‚’æŒ‡å®šã™ã‚‹ã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã§å®šç¾©ã—ãŸ rule ã‚‚åæ˜ ã•ã‚Œã‚‹](https://eslint.org/docs/developer-guide/working-with-rules#runtime-rules)ãŒã€vscode ã®æ‹¡å¼µã«ã¯åæ˜ ã•ã‚Œãªã„ã®ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã§å®šç¾©ã•ã‚ŒãŸ rule ã‚‚ plugin ã¨ã—ã¦ vscode ã®æ‹¡å¼µã§èª­ã¿è¾¼ã¾ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹

ãã®æ™‚ã«`eslint-plugin-rulesdir`ã‚’ä½¿ã†ã¨ç°¡å˜ã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã® rule ã‚’ eslint-plugin ã¨ã—ã¦æ‰±ã†ã“ã¨ãŒã§ãã‚‹ãŒã€[commit ã‚‚ã‚¹ã‚¿ãƒ¼æ•°ã‚‚å°‘ãªã„ã—](https://github.com/not-an-aardvark/eslint-plugin-rulesdir)ã¡ã‚‡ã£ã¨æ€ªã—ã„ãƒ»ãƒ»ãƒ»

ãŸã ã‚½ãƒ¼ã‚¹ã‚’ã¿ã¦ã¿ã‚‹ã¨ 1 ãƒ•ã‚¡ã‚¤ãƒ«ã—ã‹ãªãã‚„ã£ã¦ã‚‹ã“ã¨ã‚‚[ã‚·ãƒ³ãƒ—ãƒ«ã ã£ãŸã®ã§](https://github.com/not-an-aardvark/eslint-plugin-rulesdir/blob/master/index.js)ã€ã‚‚ã—ãªã‚“ã‹ã¾ãšã„ã“ã¨ãŒã‚ã£ãŸã‚‰è‡ªä½œã§ä½œã‚Šç›´ã—ã¦ eslint ã® plugin ã‚’å…¬é–‹ã™ã‚Œã°ã„ã„ã‹ãªã¨æ€ã£ãŸ

:::details ã“ã‚“ãªæ„Ÿã˜ã® plugin ã‚’å…¬é–‹ã™ã‚Œã°åŒæ§˜ã«å‹•ãã¯ãš(æœªæ¤œè¨¼)

```js
// ref: https://github.com/not-an-aardvark/eslint-plugin-rulesdir/blob/master/index.js
const fs = require("fs");
const path = require("path");

const rulesDir = "eslint-rules/dist";
module.exports = {
  get rules() {
    const filePaths = fs
      .readdirSync(rulesDir)
      .filter((fileName) => fileName.endsWith(".js"))
      .map((fileName) => path.resolve(rulesDir, fileName));

    const ruleValues = filePaths.map((filePath) => {
      return {
        ruleName: path.basename(filePath, ".js"),
        filePath,
      };
    });

    const rules = {};
    ruleValues.forEach((ruleValue) => {
      if (rules[ruleValue.ruleName]) {
        throw new Error("ãƒ«ãƒ¼ãƒ«åãŒåŒã˜ãªã®ã§ç™»éŒ²ã§ãã¾ã›ã‚“");
      }

      rules[ruleValue.ruleName] = require(ruleValue.filePath);
    });

    return rules;
  },
};
```

:::

## è£œè¶³ 2. ãƒ‡ãƒãƒƒã‚°æ–¹æ³•

ãƒ†ã‚¹ãƒˆã§ç¢ºèªã¯ã—ãŸã‘ã©ã‚‚å®Ÿéš›ã«å‹•ã‹ã—ã¦ã¿ãªã„ã¨ä¸å®‰ã ã£ãŸã‚Šã€å®Ÿéš›ã«ã©ã®ã‚ˆã†ãªå€¤ãŒå…¥ã£ã¦ã‚‹ã®ã‹ã‚’ç¢ºèªã™ã‚‹å ´åˆã®ãƒ‡ãƒãƒƒã‚°æ–¹æ³•ã€‚
context.report ã® data ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ string ã‚’æ¸¡ã›ã‚‹ã®ã§ã€ç¢ºã‹ã‚ãŸã„å€¤ã‚’dataã«æ¸¡ã—ã€ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã‚ˆã†ã« rule ã‚’è¨­å®šã—ã¦ lint ã‚’å®Ÿè¡Œã™ã‚Œã°ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ç¢ºèªã—ãŸã„å€¤ãŒå‡ºåŠ›ã•ã‚Œã‚‹
(ã‚‚ã£ã¨ã„ã„æ–¹æ³•ã‚ã‚Œã°éšæ™‚ãƒ¢ãƒˆãƒ )

:::message
ãƒ‡ãƒãƒƒã‚°ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å€¤ã‚’å‡ºåŠ›ã•ã›ã‚‹å ´åˆã¯å¯¾è±¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸€ã¤ã¨ã‹ã«ã—ã¦lintã‚’å®Ÿè¡Œã—ã¾ã—ã‚‡ã†
:::

:::details ä¾‹: context.fileName()ã®å€¤ã‚’ç¢ºèªã—ãŸã„å ´åˆ

```typescript
meta: {
  type: 'suggestion',
  messages: {
    cleanArch: '{{ message }}',
  },
  schema: [],
},
create: (context) => {
  return {
    ImportDeclaration(node) {
      context.report({
        node,
        messageId: "cleanArch",
        data: {
          message: context.getFilename(),
        },
      });
    },
  };
};
```

:::
