---
title: "Next.jsã§Nuxtã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®ã‚ˆã†ãªã‚‚ã®ã‚’å®Ÿè£…ã™ã‚‹"
emoji: "ğŸ™Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["typescript", "nextjs"]
published: false
---

## æ¦‚è¦

ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¯ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã§å®Ÿè£…ã—ã‚ˆã†

## å‰æ

CSR(ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°)å‰æã§ SSR(ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°)ã¯è€ƒæ…®ã—ãªã„

## æ®‹èª²é¡Œ

- èªè¨¼æ–¹æ³•ã«ã‚ˆã£ã¦(JWT ã‚’ã©ã“ã«ä¿å­˜ã™ã‚‹ã®ã‹ç­‰)å®Ÿè£…ãŒå¤‰ã‚ã‚‹
- local storage ã®å ´åˆã¯è¿½åŠ ã§èª¿æŸ»æ¤œè¨¼å¿…è¦ãã†

## Nuxt ã§ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¨ã¯

page å±¤ã«å®Ÿè£…ã™ã‚‹ã‚‚ã®
page ãŒãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹å‰ã«ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãŒå®Ÿè¡Œã•ã‚Œã‚‹

### ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®å®Ÿè£…

```typescript
export default function ({ store, redirect }): void {
  if (!store.state.modules.user.auth) {
    return redirect("/login");
  }
}
```

### page ã§ã®å®Ÿè£…

```typescript
@Component({
  name: 'CsvDownloadPage',
  components: {
    CsvDownloadTemplate
  },
  layout: 'sidebar',
  middleware: ['authenticated', 'refresh-token', 'not-selected-current-client']
})
```

## å®Ÿè£…ä¾‹

### ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ hooks ã®å®Ÿè£…

store(local storage ã«èªè¨¼å¾Œã® user æƒ…å ±ã‚’ä¿æŒã—ã¦ã‚‹)ã‹ã‚‰å¿…è¦ãªæƒ…å ±ãŒãªã„å ´åˆã¯ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãªã©

```tsx
export const useRequireName = (): void => {
  // local storageã«ä¿æŒã•ã‚ŒãŸuserã®å€¤
  const { user } = useUserStore();
  const router = useRouter();

  useEffect(() => {
    // NOTE: useræƒ…å ±ã‚’å–å¾—ã—ã¦ã„ã‚‹ã®ã«nameãŒãªã„å ´åˆã¯ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
    if (user.isFetched && user.name === null) {
      router.push("/store");
    }
  }, [user.name, user.isFetched]);
};
```

### page ã«ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã® hooks ã‚’å‘¼ã¶

```tsx
const RedirectPage: NextPage = () => {
  // ãƒšãƒ¼ã‚¸ã§å®šç¾©ã—ãŸã„ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®å®Ÿè£…
  useRequireName();

  const { user } = useUserStore();

  // é·ç§»å…ˆã®ãºãƒ¼ã‚¸ãŒãƒãƒ©ãƒƒã¨è¦‹ãˆã¦ã—ã¾ã†ã®ã§ãƒãƒ©ãƒƒã¨è¦‹ãˆã‚‹ã‚ˆã†ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’è¡¨ç¤ºã•ã›ã‚‹
  const [isFetch, setIsFetch] = useState<boolean>();
  useEffect(() => {
    setIsFetch(user.isFetched);
  }, [user.isFetched]);
  // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
  if (!isFetch) return <h1 style={{ color: "red" }}>ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸­</h1>;

  const router = useRouter();
  const handleMoveIndex = () => {
    router.push("/store");
  };

  return (
    <div>
      <h1>redirectã®å‹•ä½œç¢ºèª</h1>
      <button type="button" onClick={handleMoveIndex}>
        home
      </button>
    </div>
  );
};

export default RedirectPage;
```

### redux-persist ã‚’ä½¿ã£ã¦ local storage ã¨ç´ã¥ã‘ã¦ã„ã‚‹å ´åˆã®å•é¡Œç‚¹

redux ã®ã•ã‚‰ãªã‚‹ç†è§£ãŒå¿…è¦
https://zenn.dev/nus3/scraps/d04f5026bab361#comment-93fb8c26f8c76f

recoil ã«é€ƒã’ãŸã„æ°—æŒã¡

### ç‰¹å®šã®ãƒ‘ã‚¹é…ä¸‹å…¨ä½“ã«ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’åæ˜ ã—ãŸã„å ´åˆ

[å‚è€ƒ](https://zenn.dev/catnose99/articles/2169dae14b58b6#1.-%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AE%E3%83%9E%E3%82%A6%E3%83%B3%E3%83%88%E6%99%82%E3%81%AB%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%AE%E6%83%85%E5%A0%B1%E3%82%92%E5%8F%96%E5%BE%97%E3%81%97%E3%81%A6%E3%80%81%E3%82%B0%E3%83%AD%E3%83%BC%E3%83%90%E3%83%AB%E3%82%B9%E3%83%86%E3%83%BC%E3%83%88%E3%81%AB%E3%82%BB%E3%83%83%E3%83%88)

`_app.tsx` ã§å®šç¾©ã™ã‚‹
