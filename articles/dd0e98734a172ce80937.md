---
title: "Storybookã®ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã‚’Netlifyã‹ã‚‰S3ã«ç§»ç®¡ã—ãŸè©±"
emoji: "ğŸ¤ "
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["nuxtjs", "typescript", "aws cdk", "circleCI", "s3"]
published: false
---

## æœªæ•´ç†

### CDK ã§æ›¸ãã“ã¨

- S3 ã®ãƒã‚±ãƒƒãƒˆã¯ CDK ã§æ›¸ã„ãŸ
- aws s3 sync ã«å¿…è¦ãª actions`["s3:ListBucket", "s3:PutObject", "s3:GetBucketAcl"]`
- resource ã®æŒ‡å®šæ–¹æ³•
  - [`arn:aws:s3:::${config.bucketName}`,`arn:aws:s3:::${config.bucketName}/*`],
- ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã®æŒ‡å®š
- `fatal error: An error occurred (AccessDenied) when calling the ListObjectsV2 operation: Access Denied`ã®æ™‚ã®å¯¾å¿œ
  - ã¡ã‚ƒã‚“ã¨ action ãŒä»˜ä¸ã•ã‚Œã¦ã„ã‚‹ã‹
  - resource ãŒæ­£ã—ã„ã‹
  - ãƒ‡ãƒ—ãƒ­ã‚¤ã«ä½¿ã‚ã‚Œã¦ã‚‹ aws ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã® key ã«ç´ã¥ã„ã¦ã‚‹ãƒãƒªã‚·ãƒ¼ã‚’ç¢ºèªã—ã‚ˆã†
- [s3 ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã¾ã‚ã‚Š](https://qiita.com/ryo0301/items/791c0a666feeea0a704c)
  - principals
  - acl
  - ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼
- aws cdk ã§ã„ã˜ã‚Œã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¾ã‚ã‚Š
- é™çš„ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°å¯¾å¿œ(CDK ã§æ›¸ãå ´åˆ)
  - websiteIndexDocument ã‚’æŒ‡å®šã™ã‚Œã°ã‚ˆãã‹ãª

### circleci ã§æ›¸ãã“ã¨

- orbs aws-s3/sync ã®`to`ã«ã¯ç’°å¢ƒå¤‰æ•°ã¯ä½¿ãˆãªã„
- ç”Ÿæˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ gitkeep ã™ã‚‹
- ãƒ–ãƒ©ãƒ³ãƒåã‚’å–å¾—ã™ã‚‹
- persist_to_workspace ã¯`/tmp/workspace`ã«ã™ã‚‹
- `fatal error: An error occurred (AccessDenied) when calling the ListObjectsV2 operation: Access Denied`ã®æ™‚ã®å¯¾å¿œ
  - ãƒ‡ãƒ—ãƒ­ã‚¤ã«ä½¿ã‚ã‚Œã¦ã‚‹ aws ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã® key ã«ç´ã¥ã„ã¦ã‚‹ãƒãƒªã‚·ãƒ¼ã‚’ç¢ºèªã—ã‚ˆã†
- aws ã‚³ãƒãƒ³ãƒ‰ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã§å©ã„ã¦ã¿ã¦ã‚‚ã„ã„ã‹ã‚‚
- ã‚³ãƒ³ãƒ†ãƒŠã®å‹•ä½œç¢ºèªæ–¹æ³•
