---
title: "TypeScriptã§componentã®scaffoldã‚’ä½œã‚ã†"
emoji: "ğŸ "
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["react", "typescript", "nodejs"]
published: true
---

## ã¯ã˜ã‚ã«

ãµã¨ã„ã¤ã‚‚ã®ã‚ˆã†ã« React ã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œã£ã¦ã„ãŸã‚‰ã†ã¡ã® TL ã®[@kichion](https://twitter.com/kichion)ãŒ`æ¯å›åŒã˜ã‚ˆã†ãªæ§‹æˆã®ãƒ•ã‚¡ã‚¤ãƒ«ä½œã‚‹ã®é¢å€’ã ã‚`ã¨è¨€ã„å‡ºã— Golang ã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ scaffold ã™ã‚‹ CLI ã‚’ä½œã‚Šã‚ˆã£ãŸã€‚
å¤§å±¤ä¾¿åˆ©ãªãã® CLI ã¯`make scaffold COMPONENT=atoms/buttons NAME=TextButton`ã¿ãŸã„ãªã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨`src/components/atoms/buttons/TextButton`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç”¨ãƒ»storybook ç”¨ã® tsx ãƒ•ã‚¡ã‚¤ãƒ«ã€css modules ç”¨ã® css ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚ˆã—ãªã«ä½œæˆã—ã¦ãã‚ŒãŠã‚‹ã€‚
å¤§å±¤æ„ŸéŠ˜ã‚’å—ã‘ãŸ hada ã ã£ãŸãŒãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒªãƒã‚¸ãƒˆãƒªã« golang ã®ã‚³ãƒ¼ãƒ‰ãŒå…¥ã£ã¦ã‚‹ã®ã‚‚ãªãã€ã©ã†ã›ãªã‚‰ TypeScript ã§å®Œçµã—ãŸã„ã¨æ€ã„ã€golang ã§æ›¸ã‹ã‚ŒãŸ script ã‚’ TypeScript ã§æ›¸ãç›´ã™æ±ºæ„ã‚’ã—ãŸã®ã§ã‚ã£ãŸã€‚

## è¨˜äº‹ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ

- æ–°ã—ã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œã‚ãƒ¼ã£ã¨ â†’ è¡Œæ•°å°‘ãªã„ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰æ§‹æˆã‚³ãƒ”ãƒšã—ã¦æŒã£ã¦ã“ã‚ˆã† â†’ åå‰æ›¸ãæ›ãˆã‚ˆã†(ã‚ã‚“ã©ãã•ã„ãªã)ã¨æ€ã£ã¦ã‚‹äºº

## ç’°å¢ƒ

é–¢ä¿‚ã‚ã‚Šãã†ãªã¨ã“ã ã‘

```json:package.json
{
  "dependencies": {
    "react": "16.14.0",
    "react-dom": "16.14.0",
  },
  "devDependencies": {
    "@types/node": "14.14.6",
    "ts-node": "9.1.1",
    "typescript": "4.0.5"
  }
}
```

## å‰æ

å¯¾è±¡ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ atomic design ãŒæ¡ç”¨ã•ã‚Œã¦ãŠã‚Šã€ä¸€ã¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œã‚‹ã«ã¯ä¸‹è¨˜ã®ã‚ˆã†ãªæ§‹æˆã«ãªã£ã¦ã„ã‚‹

```
src/components/atoms/texts/Txt
â”œâ”€â”€ index.stories.tsx // storybookã®å®šç¾©
â”œâ”€â”€ index.tsx         // componentã®å®šç¾©
â””â”€â”€ styles.ts         // styled-componentã®å®šç¾©
```

ãã‚Œãã‚Œã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‹ãã§ç¤ºã™ã‚ˆã†ã«å…±é€šã™ã‚‹æ›¸ãæ–¹ãŒã‚ã‚Šã€ã“ã‚Œã‚‰ã‚’æ¯å›ã™ã§ã«ã‚ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ã‚³ãƒ”ãƒšã§æŒã£ã¦ãã¦åå‰ã‚’å·®ã—æ›¿ãˆã‚‹ã®ãŒé¢å€’ã§ã‚ã£ãŸã€‚

### component

```tsx:index.tsx
import classnames from 'classnames';
import React from 'react';

import { Div } from './styles';

export type TxtProps = {
  name: string;
};

export const Txt: React.FC<TxtProps> = ({ name }: TxtProps) => (
  <Div>
    <p>Enjoy {name} component life!!</p>
  </Div>
);
```

### storybook

```tsx:index.stories.tsx
import { storiesOf } from '@storybook/react';
import React from 'react';

import { Txt } from '.';

storiesOf('${path}/${name}', module).add('default', () => <Txt name="name" />);
```

### styled-component

```ts:styles.ts
import styled from 'styled-components';

// theme colorã¨ã‹ä½¿ã†ã¨ãã«å‘¼ã³å‡ºã™
// import { ThemeProps } from 'styles/Theme';

export const Div = styled.div``;
```

## ã„ã–å®Ÿè£…

### TypeScript+node.js ã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹

ts-node ã‚’ä½¿ã†ã¨ TypeScript ãƒ•ã‚¡ã‚¤ãƒ«ã®å®Ÿè¡Œã¨ node.js ã® REPL ã‚’ã‚„ã£ã¦ãã‚Œã‚‹ã®ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹

> TypeScript execution and REPL for node.js, with source map support.
> https://github.com/TypeStrong/ts-node

Next.js ã‚„ React ã‚’ä½¿ã£ã¦ã‚‹å ´åˆã€tsconfig ãŒã‚‚ã—ã‹ã—ãŸã‚‰ node.js ã§ä½¿ã†å‹ã‚’æ‰±ãˆãªã„ã‹ã‚‚ã—ã‚Œãªã„ã®ã§ä»Šå›ä½œã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆç”¨ã® tsconfig ã‚’è¨­å®šã™ã‚‹
(ä»Šå›ã¯ãƒ«ãƒ¼ãƒˆç›´ä¸‹ã« scripts ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œã‚Šã€ãã“ã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œã‚‹æƒ³å®š)

```json:scripts/tsconfig.json
{
  "extends": "../tsconfig.json",
  "compilerOptions": {
    "module": "commonjs",
    "isolatedModules": false,
    "types": ["ts-node"]
  },
  "include": ["./**/*.ts"]
}
```

### ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè£…

ç°¡å˜ 3 ã‚¹ãƒ†ãƒƒãƒ—ã ã‚ˆ

1. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåã‚’å¼•æ•°ã‹ã‚‰å—ã‘å–ã‚‹
2. ä½œæˆã—ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ã‚’å®šç¾©ã™ã‚‹
3. ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä½œæˆã™ã‚‹

ã‚³ãƒ¼ãƒ‰ã®å…¨å®¹ã¯ä¸€ç•ªæœ€å¾Œã«è¨˜è¼‰ã—ã¦ã‚„ã™

### ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè£…

ä¸‹è¨˜ã®ã‚ˆã†ãªã‚³ãƒãƒ³ãƒ‰ã‚’ package.json ã«ç™»éŒ²ã—ã¦

```json:package.json
  "scripts": {
    "scaffold": "ts-node --project scripts/tsconfig.json scripts/component_scaffold/index.ts --"
  },
```

`yarn scaffold --component=atoms/buttons --name=FooButton`
ã™ã‚‹ã¨ã‚ˆã—ãªã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œã£ã¦ãã‚Œã‚‹

### ãƒã‚¤ãƒ³ãƒˆ

- ts-node ã®`--project`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã©ã® tsconfig ä½¿ã†ã‹æŒ‡å®šã§ãã‚‹ã‚ˆ
- ts-node ã®å‹ã‚’ script ã§å‘¼ã³å‡ºã—ãŸã„æ™‚ã¯ tsconfig ã®`compilerOptions`ã®`types`ã§`ts-node`ã‚’æŒ‡å®šã—ã‚ˆã†
- ts-node ã§ã®ã‚«ã‚¹ã‚¿ãƒ å¼•æ•°ã®æŒ‡å®šã™ã‚‹å‰ã«`--`ã‚’ã„ã‚Œã‚‹
  - `ts-node --project scripts/tsconfig.json scripts/component_scaffold/index.ts -- --component=atoms/buttons --name=FooButton`
- å¼•æ•°ã‚’å—ã‘å–ã‚‹`process.argv`ãŒç‹¬ç‰¹ãªã®ã§æ°—ã‚’ã¤ã‘ã¦
- `fs`ã®`existsSync`ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å­˜åœ¨ç¢ºèªãŒã§ãã‚‹ã‚ˆ
- `fs`ã®`mkdirSync`ã§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆãŒã§ãã‚‹ã‚ˆ
- `fs`ã®`writeFileSync`ã§ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆãŒã§ãã‚‹ã‚ˆ
  - `writeFileSync`ã¯ã™ã§ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒãªã„ã¨ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™ã®ã§è¦æ³¨æ„

å‚è€ƒ: process.argv ã®è¿”ã‚Šå€¤

```
[
  '/Users/yhada/dev/project-name/node_modules/.bin/ts-node',
  '/Users/yhada/dev/project-name/scripts/component_scaffold/index.ts',
  '--',
  '--component=atoms/texts',
  '--name=Txt'
]
```

### ä»¥ä¸‹ã€ã‚³ãƒ¼ãƒ‰å…¨å®¹

:::details ã‚¹ã‚¯ãƒªãƒ—ãƒˆå…¨å®¹

```typescript:scripts/component_scaffold/index.ts
import { existsSync, mkdirSync, writeFileSync } from 'fs';

import {
  createComponentTemplate,
  createStorybookTemplate,
  createStyleTemplate
} from './templates';

const getArgValue = (arg: string): { name: string; value: string } => {
  const initStr = arg.slice(0, 2);
  if (initStr !== '--') {
    throw new Error('å¼•æ•°ãŒãŠã‹ã—ã„ã§ãƒ¤ãƒ³ã‚¹ã€‚ã€Œ--ã€ã§æŒ‡å®šã—ã¦ã»ã—ã„ã§ãƒ¤ãƒ³ã‚¹');
  }

  const equalIndex = arg.indexOf('=');
  if (equalIndex === -1) {
    throw new Error(
      'å¼•æ•°ã®æŒ‡å®šæ–¹æ³•ãŒãŠã‹ã—ã„ã§ãƒ¤ãƒ³ã‚¹ã€‚ã€Œ--component=atoms --name=ComponentNameã€ã«ã—ã¦ã»ã—ã„ã§ã‚„ã‚“ã™'
    );
  }
  const name = arg.slice(2, equalIndex);
  if (name.length === 0) {
    throw new Error('å¼•æ•°ãŒãªã„ã§ãƒ¤ãƒ³ã‚¹');
  }
  if (name !== 'component' && name !== 'name') {
    throw new Error(
      'å¼•æ•°ãŒé•ã†ã§ãƒ¤ãƒ³ã‚¹ã€‚ã€Œ--component=atoms --name=ComponentNameã€ã«ã—ã¦ã»ã—ã„ã§ã‚„ã‚“ã™'
    );
  }

  const value = arg.slice(equalIndex + 1, arg.length);
  if (value.length === 0) {
    throw new Error('å¼•æ•°ã®å€¤ãŒãªã„ã§ãƒ¤ãƒ³ã‚¹');
  }

  return { name, value };
};

const validateArgs = (args: string[]) => {
  if (args.length !== 5) {
    throw new Error(
      'å¼•æ•°ã®æ•°ãŒæ­£ã—ããªã„ã§ã‚²ã‚¹ã€‚--componentã¨--nameã‚’æŒ‡å®šã—ã¦ã»ã—ã„ã§ã‚²ã‚¹'
    );
  }
};

const main = () => {
  try {
    validateArgs(process.argv);
    const pathName = getArgValue(process.argv[3]);
    const componentName = getArgValue(process.argv[4]);

    // HACK: é›‘ãªå®Ÿè£…ã§ã™
    const path = `src/components/${pathName.value}/${componentName.value}`;
    if (!existsSync(path)) {
      mkdirSync(path, {
        recursive: true
      });
    }
    writeFileSync(
      `${path}/index.tsx`,
      createComponentTemplate(componentName.value)
    );
    writeFileSync(`${path}/styles.ts`, createStyleTemplate());
    writeFileSync(
      `${path}/index.stories.tsx`,
      createStorybookTemplate(pathName.value, componentName.value)
    );
  } catch (error) {
    // eslint-disable-next-line no-console
    console.error(error);
  }
};

main();
```

:::

:::details ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”Ÿæˆéƒ¨åˆ†

```typescript
// ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
export const createComponentTemplate = (
  name: string
): string => `// import classnames from 'classnames';
import React from 'react';

import { Div } from './styles';

export type ${name}Props = {
  name: string;
};

export const ${name}: React.FC<${name}Props> = ({ name }: ${name}Props) => (
  <Div>
    <p>Enjoy {name} component life!!</p>
  </Div>
);
`;

// storybookã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
export const createStorybookTemplate = (
  path: string,
  name: string
): string => `import { storiesOf } from '@storybook/react';
import React from 'react';

import { ${name} } from '.';

storiesOf('${path}/${name}', module).add('default', () => <${name} name="name" />);
`;

// styled-componentã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
export const createStyleTemplate = (): string => `import styled from 'styled-components';

// import { ThemeProps } from 'styles/Theme';

export const Div = styled.div\`\`;
`;
```

:::

ä»¥ä¸Šã€æ„å¤–ã¨ç°¡å˜ã«ã§ãã‚‹ scaffold ã®ãŠè©±ã§ã—ãŸï¼
