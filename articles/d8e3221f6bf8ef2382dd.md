---
title: "Cypressã§å§‹ã‚ã‚‹E2Eãƒ†ã‚¹ãƒˆ"
emoji: "ğŸ¥"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["cypress", "e2e"]
published: true
---

## ã¯ã˜ã‚ã«

`cypress`ã‚’ä½¿ã†ã¨ã¨ã¦ã‚‚ç°¡å˜ã« E2E ãƒ†ã‚¹ãƒˆã‚’è‡ªåˆ†ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã«å°å…¥ã§ããŸ[^1]ã®ã§ãã®ã¾ã¨ã‚
https://www.cypress.io/

[^1]: CI å‘¨ã‚Šã¨ã‹ç‹¬è‡ªã§ã‚„ã£ã¦ã‚‹ã“ã¨ã‚‚ã‚ã‚‹ã®ã§å‚è€ƒç¨‹åº¦ã«

## è¨˜äº‹ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ

- E2E ãƒ†ã‚¹ãƒˆãŒæ°—ã«ãªã£ã¦ã‚‹äºº

## ã‚´ãƒ¼ãƒ«

å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ç’°å¢ƒ(staging ã§ basic èªè¨¼ã—ã¦ã‚‹)ã«å¯¾ã—ã¦ CI ä¸Šã§ E2E ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã€ãƒ†ã‚¹ãƒˆçµæœã‚’ slack ã«é€šçŸ¥ã™ã‚‹

## ç’°å¢ƒ

å¿…è¦ãã†ãªã®ã ã‘

```json:package.json
{
  "dependencies": {
    "next": "10.0.7",
    "react": "17.0.1",
    "react-dom": "17.0.1",
  },
  "devDependencies": {
    "@slack/web-api": "6.0.0",
    "@types/node": "14.14.31",
    "cypress": "6.6.0",
    "ts-node": "9.1.1"
  }
}
```

## å°å…¥æ‰‹é †

1. Cypress ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨åˆæœŸè¨­å®š
2. e2e ã®ãƒ†ã‚¹ãƒˆã‚’ typescript ã§ã‹ã‘ã‚‹ã‚ˆã†ã«ã™ã‚‹
3. CircleCI ã§å®Ÿè¡Œã™ã‚‹ script ä½œã‚‹(E2E çµæœã‚’ slack ã¸é€šçŸ¥ã™ã‚‹)
4. CircleCI ã®è¨­å®š

## Cypress ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨åˆæœŸè¨­å®š

`yarn add -D cypress`ã—ã¦`yarn run cypress open`ã™ã‚‹ã¨è‡ªå‹•ã§ cypress ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒè‡ªåˆ†ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ç”Ÿæˆã•ã‚Œã‚‹
ä¸­èº«ã¯ä¸‹è¨˜ã®ã‚ˆã†ãªæ„Ÿã˜

- `fixtures` ãƒ†ã‚¹ãƒˆæ™‚ã®ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ json å½¢å¼ã§å®šç¾©ã§ãã‚‹
- `integration` çµåˆãƒ†ã‚¹ãƒˆã®å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ç½®ãã¨ã“ã‚
- `plugins` ãªã‚“ã‹ plugin ä½œã‚Œã‚‹ã‚“ã§ã—ã‚‡ã†
- `support` ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒãƒ³ãƒ‰ã‚’å®šç¾©ã§ãã‚‹ã¨ã“ã‚

ã„ãšã‚Œã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½¿ã„æ–¹ã‚„å®šç¾©ã®ä»•æ–¹ã‚‚ json ã‚„ js ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã€sample ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã®ã§ãªã‚“ã¨ãªãã‚¤ãƒ¡ãƒ¼ã‚¸ã§ãã‚‹

`cypress open`ãŒ GUI ä¸Šã§ E2E ãƒ†ã‚¹ãƒˆã‚’ç¢ºèªã™ã‚‹
`cypress run`ãŒãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ¢ãƒ¼ãƒ‰ã§ E2E ãƒ†ã‚¹ãƒˆã‚’ç¢ºèªã™ã‚‹

## e2e ã®ãƒ†ã‚¹ãƒˆã‚’ typescript ã§æ›¸ã‘ã‚‹ã‚ˆã†ã«ã™ã‚‹

ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ js ãªã®ã§ ts ã«å¤‰æ›´ã™ã‚‹ã¨è‡ªåˆ†ã®ç’°å¢ƒã§ã¯ä¸‹è¨˜ã®ã‚ˆã†ãª ts ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸ
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç›´ä¸‹ã® tsconfig.json ã®ãƒ«ãƒ¼ãƒ«ã«ä¹—ã£å–ã£ã¦ãªã„ã‚ã‚ˆã¨æ€’ã‚‰ã‚Œã¦ã‚‹

```
'integrationã«ã‚ã‚‹ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å.ts' cannot be compiled under '--isolatedModules' because it is considered a global script file. Add an import, export, or an empty 'export {}' statement to make it a module.
```

ã•ã‚‰ã« jest ã§æ›¸ã„ã¦ã‚‹ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚‚ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸ

cypress ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸéš›ã« jest ã‚‚ä½¿ã£ã¦ã‚‹ã¨ jest ã¨ cypress ã§ expect ãŒã®ã‚ˆã†ãªã‚°ãƒ­ãƒ¼ãƒãƒ«ãªç‰©ãŒç«¶åˆã—ã¦ã—ã¾ã†ã®ã§ cypress ã¨ jest ã‚’æ›¸ããŸã„ test ãƒ•ã‚©ãƒ«ãƒ€ã§ tsconfig ã‚’åˆ†ã‘ã‚‹
https://github.com/cypress-io/cypress-and-jest-typescript-example

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç›´ä¸‹ã® tsconfig(test ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« jest ã®ãƒ†ã‚¹ãƒˆãŒæ›¸ã‹ã‚Œã¦ã„ã‚‹)

```json:tsconfig.json
{
  "compilerOptions": {
    "baseUrl": "./src",
    "target": "es5",
    "module": "esnext",
    "jsx": "preserve",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "noEmit": true,
    "moduleResolution": "node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "types": ["jest"]
  },
  "exclude": ["node_modules", "deployments", ".next", "out"],
  "include": [
    "next-env.d.ts",
    "globals.d.ts",
    "src/**/*.ts",
    "src/**/*.tsx",
    "src/**/*.js",
    "test/**/*.ts"
  ]
}
```

cypress ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç›´ä¸‹ã® tsconfig

```json:cypress/tsconfig.json
{
  "extends": "../tsconfig.json",
  "compilerOptions": {
    "isolatedModules": false,
    "types": ["cypress"]
  },
  "include": ["../node_modules/cypress", "./**/*.ts"]
}
```

ã“ã‚Œã§ cypress ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç›´ä¸‹ã¯ cypress ã® type è¦‹ã¦ãã‚Œã‚‹ã—ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç›´ä¸‹ã® include ã«ã‚ã‚‹ ts ãƒ•ã‚¡ã‚¤ãƒ«ãŸã¡ã¯ jest ã‚’è¦‹ã¦ãã‚Œã‚‹

ãƒ«ãƒ¼ãƒˆç›´ä¸‹ã«`cypress.json`ã‚’é…ç½®ã™ã‚‹ã¨ã‚³ãƒ³ãƒ•ã‚£ã‚°ã¨ã—ã¦ cypress å®Ÿè¡Œæ™‚ã«å‘¼ã‚“ã§ãã‚Œã‚‹
https://docs.cypress.io/guides/references/configuration.html#Options

ç’°å¢ƒã”ã¨ã«åˆ‡ã‚Šåˆ†ã‘ãŸã„å ´åˆã¯[cli ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§æŒ‡å®šã™ã‚‹](https://docs.cypress.io/guides/guides/command-line.html#cypress-open)

`cypress open --config-file tests/cypress-config.json`

cypress ã§ã®ãƒ†ã‚¹ãƒˆã®æ›¸ãæ–¹ã¯[ã“ã“](https://docs.cypress.io/guides/core-concepts/introduction-to-cypress.html#Default-Assertions)è¦‹ã‚Œã°ã ã„ãŸã„ã‚ã‹ã‚‹
ä»Šå›ã¯è©²å½“ã®ç”»é¢ã«é·ç§»ã—ãŸæ™‚ã« 200 ã‚’è¿”ã™ã‹ã©ã†ã‹ã®ãƒã‚§ãƒƒã‚¯ã™ã‚‹ E2E ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã¿ã‚‹(ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«åã‚’`index.spec.ts`ã®ã‚ˆã†ã«ã—ã¦ãªã„ã®ã¯ jest ã®å¯¾è±¡ã«å«ã¾ã‚Œã‚‹ã®ã§ã—ã¦ãªã„ã€‚å¤šåˆ† cypress ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã ã‘å¯¾è±¡å¤–ã«ã™ã‚‹ã¨ã‹ã‚‚ã§ãã‚‹ã¯ãš)

```typescript:cypress/integration/index_spec.ts
// stagingã¯basicèªè¨¼ã‹ã‹ã£ã¦ã‚‹ã®ã§envã«ã‚ˆã£ã¦åˆ‡ã‚Šæ›¿ãˆã¦ã‚‹
describe('/', () => {
  it('visit page', () => {
    if (Cypress.env('name') === 'staging') {
      cy.visit('/', {
        auth: {
          username: 'name',
          password: 'password',
        },
      })
    } else {
      cy.visit('/upload')
    }

    // åˆå›è¡¨ç¤ºæ™‚ã«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚ã‚‹ã®ã§è‹¥å¹²å¾…æ©Ÿã—ã¦ã‚‹
    cy.wait(5000)
  })
})
```

config

```json:cypress.json
{
  "baseUrl": "http://localhost:3000",
  "env": {
    "name": "local"
  }
}
```

ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ¢ãƒ¼ãƒ‰(`cypress run`)ã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã¨ E2E ãƒ†ã‚¹ãƒˆã®æ§˜å­ãŒ`cypress/videos`ã« mp4 ãƒ•ã‚¡ã‚¤ãƒ«ã§æ ¼ç´ã•ã‚Œã‚‹
[ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­ã«éšœå®³ãŒç™ºç”Ÿã™ã‚‹ã¨`cypress/screenshots`ã«éšœå®³ç™ºç”Ÿæ™‚ã® png ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ ¼ç´ã•ã‚Œã‚‹](https://docs.cypress.io/guides/guides/screenshots-and-videos.html#Screenshots)

## CircleCI ã§å®Ÿè¡Œã™ã‚‹ script ä½œã‚‹(E2E çµæœã‚’ slack ã¸é€šçŸ¥ã™ã‚‹)

E2E ãƒ†ã‚¹ãƒˆã‚’ CircleCI ã§å®Ÿè¡Œã—ã¦ã€å®Ÿè¡Œçµæœã® mp4 ã¨ png ã‚’ã„ã„æ„Ÿã˜ã« slack ã¸é€šçŸ¥ã™ã‚‹

1. ci ä¸Šã§ ts ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«`ts-node`ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
2. tsconfig ã‚’è¨­å®šã™ã‚‹
3. slack app ã®è¨­å®š(å‰²æ„›)
4. slack ã«é€šçŸ¥ã§ãã‚‹ã‚ˆã†ã«`@slack/web-api`ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
5. E2E çµæœã‚’ slack ã§é€šçŸ¥ã™ã‚‹ script ã‹ã

### tsconfig ã®è¨­å®š

CI ã§ä½¿ã† shell ãªã©ã¯ãƒ«ãƒ¼ãƒˆç›´ä¸‹ã«`script`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç”¨æ„ã—ã¦ã‚‹ã®ã§ãã“ã« ts ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ ¼ç´ã™ã‚‹
ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®æœ‰ç„¡ã‚„æ¨™æº–å…¥åŠ›ã‚’å—ã‘å–ã‚‹ãŸã‚ã« node.js ã®æ¨™æº–æ©Ÿèƒ½ä½¿ã†ã®ã§ tsconfig ã‚’åˆ¥ã§ä½œã‚‹

module ã‚’`commonjs`ã«å¤‰ãˆã‚‹ã®ã¨ types ã§`ts-node`ã‚’æŒ‡å®šã™ã‚‹

```json:scripts/tsconfig.json
{
  "extends": "../tsconfig.json",
  "compilerOptions": {
    "module": "commonjs",
    "isolatedModules": false,
    "types": ["ts-node"]
  },
  "include": ["./**/*.ts"]
}
```

### E2E çµæœã‚’ slack ã§é€šçŸ¥ã™ã‚‹ script ã‹ã

:::message alert
ä¸‹è¨˜ã® script ã¯`cypress/integration`ç›´ä¸‹ã«ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã—ã‹ãªãã“ã‚Œä»¥ä¸Šæ·±ã„éšå±¤ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒä½œã‚‰ã‚Œãªã„æƒ³å®š[^2]ã§ã™
:::

[^2]: `cypress/integration`ã«ã¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã§ã™ãŒã€ãã†ã™ã‚‹ã¨ e2e ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå¾Œã® mp4 ã‚„ png ãŒã‚ˆã‚Šæ·±ã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç”Ÿæˆã•ã‚Œã‚‹ã“ã¨ã«ãªã‚Šã€script å´ã§å†èµ·çš„ã«ãã‚Œã‚’å–å¾—ã™ã‚‹ã®ãŒé¢å€’ã ã£ãŸ

```typescript:scripts/report_e2e/main.ts
import { Block, KnownBlock, WebClient } from '@slack/web-api'
import { createReadStream, existsSync, readdirSync } from 'fs'

// NOTE: circleCIä¸Šã®ç’°å¢ƒå¤‰æ•°
const {
  CIRCLE_PROJECT_REPONAME,
  CIRCLE_WORKFLOW_ID,
  SLACK_ACCESS_TOKEN, // ã†ã¡ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ãƒ‡ãƒ—ãƒ­ã‚¤å‘¨ã‚Šã‚’é€šçŸ¥ã™ã‚‹slack appã®tokenã‚’circleciã®contextã«å…¥ã‚Œã¦ã‚‹
} = process.env

const CHANNEL = 'channel-name' // é€šçŸ¥ã—ãŸã„ãƒãƒ£ãƒ³ãƒãƒ«å
const SLACK = new WebClient(SLACK_ACCESS_TOKEN)

const sendMessage = async (
  blocks: (KnownBlock | Block)[],
  text: string,
): Promise<void> => {
  await SLACK.chat.postMessage({
    channel: CHANNEL,
    blocks: blocks,
    text: text,
  })
}

// /cypress/screenshotsã«ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å–å¾—ã™ã‚‹
const getScreenShots = (): string[] => {
  const basePath = `${process.cwd()}/cypress/screenshots`

  if (!existsSync(basePath)) return []

  const dirNames = readdirSync(basePath)
  const fileNames = dirNames.map((dirName) => {
    const fs = readdirSync(`${basePath}/${dirName}`)
    return fs.map((f) => `${dirName}/${f}`)
  })

  return fileNames.flat()
}

const getVideos = (): string[] => {
  const basePath = `${process.cwd()}/cypress/videos`
  if (!existsSync(basePath)) return []
  return readdirSync(basePath)
}

// ã©ã‚“ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ãªã‚‹ã‹ã¯ã‚¹ã‚¯ã‚·ãƒ§è¦‹ã¦ãã ã•ã„
const sendHeaderMessage = async (event: 'success' | 'fail'): Promise<void> => {
  const message = event === 'success' ? 'E2Eãƒ†ã‚¹ãƒˆæˆåŠŸ!' : 'E2Eãƒ†ã‚¹ãƒˆå¤±æ•—!!'
  // ã“ã“ã‚‰è¾ºã¯è‡ªåˆ†ã®ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã«ã‚ã‚‹emojiä½¿ã£ã¦ãã ã•ã„(ãªãã¦ã‚‚ã„ã„)
  const emoji = event === 'success' ? ':circleci-pass:' : ':circleci-fail:'

  const headerBlocks: (KnownBlock | Block)[] = [
    {
      type: 'section',
      text: {
        type: 'mrkdwn',
        text: `${emoji} *<https://circleci.com/workflow-run/${CIRCLE_WORKFLOW_ID}|${message}>*`,
      },
    },
    {
      type: 'context',
      elements: [
        {
          type: 'mrkdwn',
          text: `repository: *<https://github.com/nus3/${CIRCLE_PROJECT_REPONAME}| ${CIRCLE_PROJECT_REPONAME}>*`,
        },
      ],
    },
    {
      type: 'divider',
    },
    {
      type: 'section',
      text: {
        type: 'plain_text',
        text: 'ä¸‹è¨˜ã¯E2Eæ™‚ã®ã‚¹ã‚¯ã‚·ãƒ§ãŸã¡',
        emoji: true,
      },
    },
  ]

  await sendMessage(headerBlocks, 'header message')
}

// pngã‚’ãã®ã¾ã¾ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚‹
const sendScreenShots = (fileNames: string[]) => {
  fileNames.forEach((f) => {
    SLACK.files.upload({
      channels: CHANNEL,
      title: f,
      file: createReadStream(`${process.cwd()}/cypress/screenshots/${f}`),
    })
  })
}

// mp4ã‚’ãã®ã¾ã¾ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚‹
const sendVideos = (fileNames: string[]) => {
  fileNames.forEach((f) => {
    SLACK.files.upload({
      channels: CHANNEL,
      title: f,
      file: createReadStream(`${process.cwd()}/cypress/videos/${f}`),
    })
  })
}

const main = async () => {
  const screenshots = getScreenShots()
  const videoNames = getVideos()

  if (!screenshots.length && !videoNames.length) return
  if (process.argv.length < 3) return

  // ä¸‹è¨˜ã®ã‚ˆã†ãªã‚³ãƒãƒ³ãƒ‰ã§e2eãƒ†ã‚¹ãƒˆãŒæˆåŠŸã—ãŸã‹å¤±æ•—ã—ãŸã‹ã‚’å¼•æ•°ã«å—ã‘å–ã‚‹(success | fail)
  // ts-node --project scripts/tsconfig.json scripts/report_e2e/main.ts success
  const event = process.argv[2] as 'success' | 'fail'
  await sendHeaderMessage(event)

  if (screenshots.length) {
    sendScreenShots(screenshots)
  }
  if (videoNames.length) {
    sendVideos(videoNames)
  }
}

main()

```

slack ã«é€šçŸ¥ã•ã‚Œã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
![slack ã«é€šçŸ¥ã•ã‚Œã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸](https://storage.googleapis.com/zenn-user-upload/d7jkepskw8l0ylj36qr0aetwe4xx)

## CircleCI ã®è¨­å®š

yarn ã‹ã‚‰å®Ÿè¡Œã§ãã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’ã„ãã¤ã‹ç™»éŒ²ã—ã¨ã

```json
    "cypress:install": "cypress install",
    "cypress:staging:run": "cypress run --config-file cypress.staging.json",
    "cypress:success-report": "ts-node --project scripts/tsconfig.json scripts/report_e2e/main.ts success",
    "cypress:fail-report": "ts-node --project scripts/tsconfig.json scripts/report_e2e/main.ts fail"
```

é–¢ä¿‚ã‚ã‚‹éƒ¨åˆ†ã ã‘

```yaml:.circleci/config.yml
executors:
  with_browsers:
    working_directory: /home/circleci/src/
    docker:
      - image: circleci/node:14.16.0-browsers

# ãƒ»ãƒ»ãƒ»ãƒ»

  e2e:
    # cypressã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯å¿…è¦ãªdependenciesã‚’ã„ã‚Œã‚‹
    # https://docs.cypress.io/guides/getting-started/installing-cypress.html#Ubuntu-Debian
    executor: with_browsers
    steps:
      - checkout
      - attach_workspace:
          at: .
      - run:
          # yarnã ã‘ã§ãªãcypressã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒãªã„ã¨ciä¸Šã§å‹•ã‹ãªã„ã®ã§cypress installã—ã¦ã‚‹
          name: install cypress
          command: yarn cypress:install
      - run:
          name: e2e test
          command: yarn cypress:staging:run
      - run:
          name: notify slack
          command: yarn cypress:success-report
          # stepãŒæˆåŠŸã—ãŸã‹ã©ã†ã‹ã§å®Ÿè¡Œã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å¼•æ•°ã‚’å¤‰ãˆã¦ã‚‹
          when: on_success
      - run:
          name: notify slack
          command: yarn cypress:fail-report
          when: on_fail

      # ä»Šå›ã¯å¿…è¦ãªã„ã‘ã©ä¸‡ãŒä¸€slack apiã‹ã‚‰mp4ã‚„pngãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ããªã‹ã£ãŸã¨ãã®ãŸã‚ã«artifactsã«ä¿å­˜ã—ã¦ã‚‹
      - store_artifacts:
          path: cypress/videos
      - store_artifacts:
          path: cypress/screenshots


# ãƒ»ãƒ»ãƒ»ãƒ»
      # ä»Šå›ã¯stagingâ†’mainã¸ãƒ—ãƒ«ãƒªã‚¯ã‚’ç”Ÿæˆã—ãŸæ™‚ã«stagingã§e2eã‚’å®Ÿè¡Œã™ã‚‹æƒ³å®š
      - e2e:
          name: e2e testing for stage
          context: staging
          requires:
            - build
          filters:
            tags:
              ignore: /.*/
            branches:
              only:
                - /staging\/.*/
```

## ãã®ä»–

[node.js ã§ã®ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã¨ã‹æ¨™æº–å…¥åŠ›](https://www.gesource.jp/weblog/?p=8213)ã¨ã‹ãã“ã‚‰ã¸ã‚“èª¿ã¹ã‚‹ã®ã«æ™‚é–“ã‹ã‹ã£ãŸã‚ˆã­ãƒ»ãƒ»
ã‚ã¨ ts ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç°¡å˜ã«å®Ÿè¡Œã—ãŸã„ã®ã« ts-node ã¨ tsconfig å‘¨ã‚Šã¨ã‹ãƒ»ãƒ»
